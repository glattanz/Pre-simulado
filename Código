/*Pré-simulado
Nome: Gabrielle Lattanzi
Professor: Sergio Netto*/

#include <stdio.h>
#include <stdlib.h>
#include<string.h>
#include<time.h>
#include <locale.h>

struct empresa {
	char tpservico[30], data[10], codigo[30];
	int hr, ts, cod, dia, mes;
	float vs;
};

float resp3, mgeral, mrep, mmanu;

empresa resp5;

void preencher(int n, empresa*os){
	for(int i=0;i<n;i++)
	{
		//Código, Horas e Tipo de Serviço
		os[i].cod = rand()% 1001 + 1000;
		os[i].ts = rand()% 2 +1;
		os[i].hr = rand()% 81 + 20;	
		
		if(os[i].ts==1){
			sprintf(os[i].tpservico,"Reparo\t\t");
			sprintf(os[i].codigo,"OS%dR", os[i].cod);
		}
		
		if(os[i].ts==2){
			sprintf(os[i].tpservico,"Manutenção\t");
			sprintf(os[i].codigo,"OS%dM", os[i].cod);
		}
		
		//Valor do Serviço		
		if(os[i].ts==1){
			os[i].vs=(os[i].hr*150)+750;
		}
		else if(os[i].ts==2){
			os[i].vs=(os[i].hr*100)+500;
		}
		
		//Data
		/*os[i].mes = rand()% 3 + 8;
		
		if(os[i].mes!=2){
			os[i].dia = rand()% 31 + 1;
		}
		else{
			os[i].dia = rand()% 30 + 1;
		}
		
		sprintf(os[i].data, "%d/%d", os[i].dia, os[i].mes);*/
		
	}
}

void q3(int n, empresa*os){
	int i, menor40;
	
	for(int i=0;i<n;i++)
	{
		if(os[i].hr<40){
			menor40++;
		}	
	}
	
	resp3 = (menor40*100)/42;
}

float q4_geral(int n, empresa*os){
	int i, hgeral=0, mgeral=0;
	
	for(int i=0;i<n;i++)
	{
		hgeral += os[i].hr;
	}
	
	mgeral = hgeral/42;
	
	return(mgeral);
	
}

float q4_rep(int n, empresa*os){
	int i, reparo=0, hrep=0, mrep=0;
	
	for(int i=0;i<n;i++)
	{
		if(os[i].ts==1){
			reparo++;
			hrep += os[i].hr;
		}
	}
	
	mrep = hrep/reparo;
	
	return(mrep);
	
}

float q4_manu(int n, empresa*os){
	int i, manutencao=0, hmanu=0, mmanu=0;
	
	for(int i=0;i<n;i++)
	{
		
		if(os[i].ts==2){
			manutencao++;
			hmanu += os[i].hr;
		}
	}

	mmanu = hmanu/manutencao;

	return(mmanu);
	
}

void q5(int n, empresa*os){
	int i;
	
	float maior_custo=0;
	
	for(i=0;i<n;i++){
		if(os[i].vs>maior_custo){
			maior_custo=os[i].vs;
			
			resp5=os[i];
		}				
	}	
	
}

void imprimir(int n, empresa*os, float r4_geral, float r4_rep, float r4_manu){
	
	printf("\nCódigo\tTipo de Serviço\tHoras\tValor \n");
	
	for(int i=0;i<n;i++)
	{
	printf("%s\t%s%d\tR$%.2f\n", os[i].codigo, os[i].tpservico, /*os[i].data*/ os[i].hr, os[i].vs);
	}
	
	printf("\n==================================================\n");
	printf("\n3. Percentual de serviços com duração menor que 40 Horas: %.0f%%", resp3);
	
	printf("\n==================================================\n");
	printf("\n4. Média de horas de Geral: %.2f", r4_geral);
	printf("\nMédia de horas de Reparo: %.2f", r4_rep);
	printf("\nMédia de horas de Manutenção: %.2f", r4_manu);
	
	printf("\n==================================================\n");
	printf("\n5. OS de maior custo:\n%s\t%s%d\tR$%.2f\n", resp5.codigo, resp5.tpservico, /*resp5.data*/ resp5.hr, resp5.vs);
}

void arquivo(int n, empresa*os, float r4_geral, float r4_rep, float r4_manu){
	FILE *arquivo;
	arquivo = fopen("arquivo_presimulado.txt", "w");
	fprintf(arquivo, "\nCódigo\tTipo de Serviço\tHoras\tValor \n");
	for(int i=0;i<n;i++)
	{
	fprintf(arquivo, "%s\t%s%d\tR$%.2f\n", os[i].codigo, os[i].tpservico, os[i].hr, os[i].vs);
	}
	fprintf(arquivo, "\n3. Percentual de serviços com duração menor que 40 Horas: %.0f%%\n", resp3);
	fprintf(arquivo, "\n4. Média de horas de Geral: %.2f\n", r4_geral);
	fprintf(arquivo, "\nMédia de horas de Reparo: %.2f\n", r4_rep);
	fprintf(arquivo, "\nMédia de horas de Manutenção: %.2f\n", r4_manu);
	fprintf(arquivo, "\n5. OS de maior custo:\n%s\t%s%d\tR$%.2f\n", resp5.codigo, resp5.tpservico, /*resp5.data*/ resp5.hr, resp5.vs);
	fclose(arquivo);
	printf("\nO arquivo foi criado com sucesso!\n");
}

int main(){
	srand(time(NULL));
	fflush(stdin);
	setlocale(LC_ALL, "Portuguese");
	
	int i;
	empresa os[42];
	
	preencher(42, os);
	q3(42, os);
	
	q4_geral(42, os);
	float r4_geral=q4_geral(42,os);
	
	q4_rep(42, os);
	float r4_rep=q4_rep(42,os);
	
	q4_manu(42, os);
	float r4_manu=q4_manu(42,os);
	
	imprimir(42, os, r4_geral, r4_rep, r4_manu);
	
	arquivo(42, os, r4_geral, r4_rep, r4_manu);
	
	system("pause");
	return(0);

}
